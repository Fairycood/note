# 操作系统引论

## 目标和作用

**定义**： 操作系统是直接控制和管理计算机硬件、软件资源的最基本的系统软件
【==关键点==：系统软件，程序模块的集合，资源管理和用户接口功能】

**目标**： 方便、有效（提高系统资源的利用率，提高系统的吞吐量）、可扩充（模块化，层次化，微内核）、 开放

**作用**： 作为用户和计算机硬件系统之间的接口（命令，系统调用，图标-窗口）， 计算机系统资源的管理者（管理对象、管理内容）， 作为扩从机器/处理机

发展动力：不提高计算机资源利用率的需要、方便用户、器件的不断更新迭代】计算机体系结构的不断发展

## 发展过程

![image-20210612152516237](https://i.loli.net/2021/06/12/KFTv2dYIm3ZUQBS.png)

#### 无操作系统

**特点**：用户独占全机，资源利用率低；CPU等待用户，CPU利用率低
**提高效率的途径**：专门的操作员，批处理；脱机I/O方式

**脱机I/O方式**
![image-20210612202213995](https://i.loli.net/2021/06/12/kluIes5aW7oHjBq.png)

优点：减少CPU空闲时间；提高I/O速度

#### 单道批处理系统

**概念**：系统对作业的处理都是成批进行的、且内存中始终只保持==一道作业==
（批处理系统的引入是为了提高系统资源的利用率和吞吐量）

**特征**：自动性、顺序性、单道性

**缺点**：CPU和I/O设备使用忙闲不均（对计算机为主的作业，对I/O为主的作业，CPU空闲）

#### 多道批处理系统（多进程结构和进程管理概念萌芽）

**概念**：内存中同时存放几个作业（多道）【宏观上并行运行：都处于运行状态，但都并未运行完；微观上串行运行：各作业交替使用CPU】

**特征**：多道性、无序性、调度性（作业调度、进程调度）

与单道对比
![image-20210612202245663](https://i.loli.net/2021/06/12/wYABDEoLrbqkWxy.png)

**优点**：1.==资源利用率高==：CPU和内存利用率较高；2. ==作业吞吐量大==：单位时间内完成的工作总量大；
**缺点**：1. ==用户交互性差==：整个作业完成后或中间出错时，才与用户交互，不利于调试和修改；2.==作业平均周转时间长==：短作业的周转时间显著增长；

#### 分时操作系统

**概念**：指一台主机上连接了多个带有显示器和键盘的终端，同时允许多个用户共享主机中的资源，各个用户都可以通过自己的终端以交互的方式使用计算机

**分时**：把计算机的系统资源（尤其是CPU时间）进行时间上的分割，每个时间段成为一个时间片，每个用户轮流使用时间片

**实现方式**：终端有缓冲区暂存用户命令，作业直接进入内存，时间片轮转方式

**优点**：==交互性==：人机交互；==多路性==：多用户共享主机；==独立性==：各用户独立操作，互不干扰

#### 实时系统

**定义**：是指系统能及时(或即时)响应外部事件的请求，在规定的时间内完成对该事件的处理，并控制所有实时任务协调一致地运行。

**实时任务**：
（1）按是否呈现周期性划分：周期性实时任务和非周期性实时任务
（2）按截止时间的要求来划分：硬实时任务和软实时任务

**与分时系统特征比较**：多了及时性和可靠性

## 操作系统的基本特征

#### 并发

**并行**是指两个或多个事件在同一时刻发生
**并发**是指两个或多个事件在同一时间间隔内发生

#### 共享

系统中资源可供内存中多个并发执行的进程共同使用

互斥共享：一段时间只允许一个进程访问改资源

同时访问：微观上仍是互斥的

#### 虚拟

通过某种技术让一个物理实体变成若干逻辑上的对应物的功能。（虚拟处理机，虚拟内存，虚拟外部设备，虚拟信道）

#### 异步

进程==交替==执行，走走停停，运行进度不可预知

## 操作系统的基本功能

#### 处理机管理

多道环境下，处理机的运行及分配都是以==进程==为单位，因此处理机管理可归结为进程管理

1.进程控制
2.进程同步
3.进程通信
4.调度（作业与进程）

#### 存储管理

**目的**：方便用户使用，且提高存储器利用率

1.内存分配
2.内存保护
3.地址映射
4.内存扩充

#### 设备管理

**任务**：提高I/O利用率和速度，方便用户

1.缓冲管理
2.设备分配
3.设备处理
4.设备独立性和虚拟设备

#### 文件管理

**任务**：方便用户，提供安全性
1.文件存储空间的管理
2.目录管理
3.文件的读、写管理和存取控制（保护）

#### 用户接口

1.命令接口
2.程序接口
3.图形接口

## 错误习题

![image-20210614140501355](https://i.loli.net/2021/06/14/X7zWRjS56NvwV43.png)

![image-20210614140442593](https://i.loli.net/2021/06/14/qyWirJ3LfVcGsvN.png)

![image-20210614140519490](C:/Users/13pro/AppData/Roaming/Typora/typora-user-images/image-20210614140519490.png)

![image-20210614140559428](https://i.loli.net/2021/06/14/vd9Zg5PVNXl2KDm.png)

![image-20210614140622658](https://i.loli.net/2021/06/14/oPUSNrQER6kXtHs.png)

![image-20210614140652720](https://i.loli.net/2021/06/14/p8ZrB1Cz7TylOgP.png)

# 进程管理

程序的并发执行：多个程序在同一时间间隔内交替执行
特征：间断性；失去封闭性；不可再现性

## 进程描述

**定义**：程序的一次执行过程

**进程的特征**：
1.结构特征：进程由程序段、数据段及进程控制块三部分组成，总称“进程映像”
2.动态性
3.并发性：只有建立了进程才能并发执行
4.独立性：独立运行，独立获得资源
5.异步性（间断性）

**进程的三种基本状态及其转换**
![image-20210614141133789](https://i.loli.net/2021/06/14/U5aeLhGVglu74YX.png)

**挂起状态**
![image-20210614142044050](https://i.loli.net/2021/06/14/fuerIHs3XkPAp2L.png)

**进程控制块**：进程存在的唯一标志

## 进程控制

#### 进程的创建

**引起创建的事件**：用户登录； 作业调度；提供服务；应用请求

**创建步骤**：1.申请空白PCB；2.为新进程分配资源；3.初始化PCB；4.将新进程插入就绪队列

#### 进程的终止（撤销进程）

**引起终止的事件**：正常结束；异常结束；外界干扰（系统员kill进程；父进程终止；父进程请求）

**终止过程**：1.检查进程状态；2.执行态中止，且置调度标志为真；3.有无子孙需终止；4.归还资源给其父进程或系统；5.从PCB队列中移出PCB

#### 进程的阻塞和唤醒

**引起阻塞和唤醒的事件**：请求系统服务而得不到满足时，如向系统请求打印服务；启动某种操作而需同步时：如该操作和请求该操作的进程需同步运行；新数据尚未到达：如进程A写，进程B读，则A未写完，B不能读；无新工作可做

## 进程同步

**同步**：并发进程在执行次序上的协调，以达到有效的资源共享和相互合作，使程序执行有可再现性

**两种形式的制约关系**：
资源共享关系（进程间接制约）：需互斥地访问临界资源
相互合作关系（进程直接制约）

**临界资源**：一次仅允许一个进程访问的资源

#### 整型信号量

信号量类型是特殊类型，只能做wait【P操作】(申请一个单位资源),signal操作【V操作】（释放一个单位资源）

**利用信号量实现互斥关系**：PV总是成对出现在同一进程中
**利用信号量实现同步关系**：PV总是成对出现在不同进程中
**利用信号量实现前驱关系**：有多少前驱关系设置多少个信号量，初值为0；有多少前驱做多少个P操作，有多少后继点做多少V操作，无前驱不做P操作

#### 记录型信号量机制

![image-20210615160620183](https://i.loli.net/2021/06/15/Iwx8cTGpzrDmAQW.png)

#### AND信号量

可以有效解决死锁

**特点**：要么全分配，要么一个也不分配

**三种特例**：
![image-20210615161204507](https://i.loli.net/2021/06/15/XZPSuzRckMUGw4W.png)

## 	进程通信

进程间的信息交换

#### 进程通信的类型

**一、共享存储器系统（高效，速度快）**
**二、管道通信**
管道：连接一个读进程和一个写进程之间通信的共享文件
**三、消息传递系统（可用于异种机）**
信息单位：消息（报文）
**四、客户服务器系统**
当前网络环境主流的通信机制

#### 消息传递通信的实现方式

**一、直接传递系统**：1.直接通信原语；2.消息格式；3.进程同步方式；4.通信链路
**二、简介（可以实现非实时通信）**：有点：在读/写时间上的随机性

## 线程

**定义**：线程是系统独立调度和分派的基本单位

**线程与进程比较**
![ ](https://i.loli.net/2021/06/15/3rTHjJs5RtXvbn9.png)

# 处理机调度与死锁

## 调度的层次

#### 高、中、低三级调度

**高级调度（作业调度、长程调度、接纳调度）**
将外存作业调入内存，创建PCB等，插入就绪队列（一般用于批处理系统，分/实时系统一般直接进入内存，无此环节）

**低级调度（进程调度、短程调度）**
非抢占方式：简单，实时性差（如win31）
抢占方式：1.时间片原则；2.优先权原则；3.短作业优先原则

**中级调度（中程）**

#### 选择调度方式和算法的若干准则

**面向用户的准则**：
周转时间短（常用于批处理系统）
响应时间快（对交互作业）
截止时间的保证（特别于实时系统）
优先权准则（即需要抢占调度）

**面向系统的准则**：
吞吐量高（特别于批处理）
处理机利用率好（因CPU贵）
各类资源的平衡利用

**平均周转时间和平均带权周转时间**：
![image-20210616162033392](https://i.loli.net/2021/06/16/qjSrDlhcCnkzOUY.png)

## 调度算法

#### 先来先服务和短作业进程优先调度算法

**先来先服务**（FCFS）

**特点**：简单、有利于长作业

**短作业进程优先调度算法**（SJF）

提高了平均周转时间和平均带权周转时间（从而提高了系统吞吐量）；对长作业不利，有可能得不到服务（饥饿）；估计时间不易确定

**FCFS和SJF比较**：
![image-20210616163050867](https://i.loli.net/2021/06/16/yiSwosjuavV2JQ8.png)

#### 高优先权优先调度算法

![image-20210616164945028](https://i.loli.net/2021/06/16/jxM5SCkNzAq43L6.png)

#### 基于时间片的轮转调度算法

**时间片轮转算法**
![image-20210616171055996](https://i.loli.net/2021/06/16/xGMQ4s3D2jRzOpc.png)

**特点**：长、短作业兼顾，有较好的响应时间（短作业一次完成，中型作业周转时间不长，大型作业不会长期不处理）

**例题**：
![image-20210616212756210](https://i.loli.net/2021/06/16/MwKxk6AEPmntF5Y.png)

![image-20210617145311962](https://i.loli.net/2021/06/17/m169krPSOeLpIjn.png)

## 实时调度

#### 实时调度算法的分类

**非抢占式调度算法**：
![image-20210617171133249](https://i.loli.net/2021/06/17/7rG5RzEq3CBe9wI.png)

**抢占式调度算法**：
![image-20210617171342336](https://i.loli.net/2021/06/17/mI8vibac3o61BXk.png)

#### 常用的实时调度算法

**最早截止时间优先EDF算法**：
![image-20210617171909175](https://i.loli.net/2021/06/17/5wTNnfoxSiv6HcG.png)

**最低松弛度优先LLF算法**：
![image-20210617171952016](https://i.loli.net/2021/06/17/RhECTo2ZVypPdAa.png)

## 死锁

**产生死锁原因**：
1.竞争资源引起死锁
2.进程推进顺序不当引起死锁

**产生死锁的必要条件**：
1.互斥条件（资源的临界性）；2.请求和保持条件；3.不剥夺条件；4.环路等待

#### 处理死锁的基本方法

**1.预防：破坏4个必要条件之一（有效，但是资源利用率低）**

**2.避免：防止进入不安全状态（允许动态申请资源，银行家算法）**
安全状态：按某种顺序并发进程都能达到获得最大资源而顺序完成的序列为安全序列；能找到安全序列的状态为安全状态
**银行家算法**（一种能避免死锁的调度算法）
![image-20210618133611926](https://i.loli.net/2021/06/18/Ryp9LeN8Okimo6n.png)

**3.检测：检测到死锁再清除**

**4.与“检”配套**

